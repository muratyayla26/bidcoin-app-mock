{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createDeferredManager = void 0;\nconst createDeferred_1 = require(\"./createDeferred\");\nconst createDeferredManager = options => {\n  const {\n    initialId = 0,\n    timeout: defaultTimeout = 0,\n    onTimeout\n  } = options !== null && options !== void 0 ? options : {};\n  const promises = [];\n  let ID = initialId;\n  let timeoutHandle;\n  const length = () => promises.length;\n  const nextId = () => ID;\n  const replanTimeout = () => {\n    const now = Date.now();\n    const nearestDeadline = promises.reduce((prev, _ref) => {\n      let {\n        deadline\n      } = _ref;\n      return (prev && deadline ? Math.min : Math.max)(prev, deadline);\n    }, 0);\n    if (timeoutHandle) clearTimeout(timeoutHandle);\n    timeoutHandle = nearestDeadline ? setTimeout(timeoutCallback, Math.max(nearestDeadline - now, 0)) : undefined;\n  };\n  const timeoutCallback = () => {\n    const now = Date.now();\n    promises.filter(promise => promise.deadline && promise.deadline <= now).forEach(promise => {\n      onTimeout === null || onTimeout === void 0 ? void 0 : onTimeout(promise.id);\n      promise.deadline = 0;\n    });\n    replanTimeout();\n  };\n  const create = function () {\n    let timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultTimeout;\n    const promiseId = ID++;\n    const deferred = (0, createDeferred_1.createDeferred)(promiseId);\n    const deadline = timeout && Date.now() + timeout;\n    promises.push(Object.assign(Object.assign({}, deferred), {\n      deadline\n    }));\n    if (timeout) replanTimeout();\n    return {\n      promiseId,\n      promise: deferred.promise\n    };\n  };\n  const extract = promiseId => {\n    const index = promises.findIndex(_ref2 => {\n      let {\n        id\n      } = _ref2;\n      return id === promiseId;\n    });\n    const [promise] = index >= 0 ? promises.splice(index, 1) : [undefined];\n    if (promise === null || promise === void 0 ? void 0 : promise.deadline) replanTimeout();\n    return promise;\n  };\n  const resolve = (promiseId, value) => {\n    const promise = extract(promiseId);\n    promise === null || promise === void 0 ? void 0 : promise.resolve(value);\n    return !!promise;\n  };\n  const reject = (promiseId, error) => {\n    const promise = extract(promiseId);\n    promise === null || promise === void 0 ? void 0 : promise.reject(error);\n    return !!promise;\n  };\n  const rejectAll = error => {\n    promises.forEach(promise => promise.reject(error));\n    const deleted = promises.splice(0, promises.length);\n    if (deleted.length) replanTimeout();\n  };\n  return {\n    length,\n    nextId,\n    create,\n    resolve,\n    reject,\n    rejectAll\n  };\n};\nexports.createDeferredManager = createDeferredManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","createDeferredManager","createDeferred_1","require","options","initialId","timeout","defaultTimeout","onTimeout","promises","ID","timeoutHandle","length","nextId","replanTimeout","now","Date","nearestDeadline","reduce","prev","_ref","deadline","Math","min","max","clearTimeout","setTimeout","timeoutCallback","undefined","filter","promise","forEach","id","create","arguments","promiseId","deferred","createDeferred","push","assign","extract","index","findIndex","_ref2","splice","resolve","reject","error","rejectAll","deleted"],"sources":["C:/Users/Administrator/solana-wallet-app/node_modules/@trezor/utils/lib/createDeferredManager.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createDeferredManager = void 0;\nconst createDeferred_1 = require(\"./createDeferred\");\nconst createDeferredManager = (options) => {\n    const { initialId = 0, timeout: defaultTimeout = 0, onTimeout } = options !== null && options !== void 0 ? options : {};\n    const promises = [];\n    let ID = initialId;\n    let timeoutHandle;\n    const length = () => promises.length;\n    const nextId = () => ID;\n    const replanTimeout = () => {\n        const now = Date.now();\n        const nearestDeadline = promises.reduce((prev, { deadline }) => (prev && deadline ? Math.min : Math.max)(prev, deadline), 0);\n        if (timeoutHandle)\n            clearTimeout(timeoutHandle);\n        timeoutHandle = nearestDeadline\n            ?\n                setTimeout(timeoutCallback, Math.max(nearestDeadline - now, 0))\n            : undefined;\n    };\n    const timeoutCallback = () => {\n        const now = Date.now();\n        promises\n            .filter(promise => promise.deadline && promise.deadline <= now)\n            .forEach(promise => {\n            onTimeout === null || onTimeout === void 0 ? void 0 : onTimeout(promise.id);\n            promise.deadline = 0;\n        });\n        replanTimeout();\n    };\n    const create = (timeout = defaultTimeout) => {\n        const promiseId = ID++;\n        const deferred = (0, createDeferred_1.createDeferred)(promiseId);\n        const deadline = timeout && Date.now() + timeout;\n        promises.push(Object.assign(Object.assign({}, deferred), { deadline }));\n        if (timeout)\n            replanTimeout();\n        return { promiseId, promise: deferred.promise };\n    };\n    const extract = (promiseId) => {\n        const index = promises.findIndex(({ id }) => id === promiseId);\n        const [promise] = index >= 0 ? promises.splice(index, 1) : [undefined];\n        if (promise === null || promise === void 0 ? void 0 : promise.deadline)\n            replanTimeout();\n        return promise;\n    };\n    const resolve = (promiseId, value) => {\n        const promise = extract(promiseId);\n        promise === null || promise === void 0 ? void 0 : promise.resolve(value);\n        return !!promise;\n    };\n    const reject = (promiseId, error) => {\n        const promise = extract(promiseId);\n        promise === null || promise === void 0 ? void 0 : promise.reject(error);\n        return !!promise;\n    };\n    const rejectAll = (error) => {\n        promises.forEach(promise => promise.reject(error));\n        const deleted = promises.splice(0, promises.length);\n        if (deleted.length)\n            replanTimeout();\n    };\n    return { length, nextId, create, resolve, reject, rejectAll };\n};\nexports.createDeferredManager = createDeferredManager;\n//# sourceMappingURL=createDeferredManager.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}