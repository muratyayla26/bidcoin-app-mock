{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TypeClone = exports.Optional = exports.Type = exports.AssertWeak = exports.Assert = exports.Validate = void 0;\nconst typebox_1 = require(\"@sinclair/typebox\");\nObject.defineProperty(exports, \"Optional\", {\n  enumerable: true,\n  get: function () {\n    return typebox_1.Optional;\n  }\n});\nObject.defineProperty(exports, \"TypeClone\", {\n  enumerable: true,\n  get: function () {\n    return typebox_1.TypeClone;\n  }\n});\nconst errors_1 = require(\"@sinclair/typebox/errors\");\nconst ts_mixer_1 = require(\"ts-mixer\");\nconst custom_types_1 = require(\"./custom-types\");\nconst errors_2 = require(\"./errors\");\nconst utils_1 = require(\"./utils\");\nclass CustomTypeBuilder extends (0, ts_mixer_1.Mixin)(typebox_1.JavaScriptTypeBuilder, custom_types_1.ArrayBufferBuilder, custom_types_1.BufferBuilder, custom_types_1.KeyofEnumBuilder, custom_types_1.UintBuilder) {}\nfunction Validate(schema, value) {\n  try {\n    Assert(schema, value);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nexports.Validate = Validate;\nfunction FindErrorInUnion(error) {\n  const currentValue = error.value;\n  const unionMembers = error.schema.anyOf;\n  const hasValidMember = unionMembers.find(unionSchema => Validate(unionSchema, currentValue));\n  if (!hasValidMember) {\n    const possibleMatchesByLiterals = unionMembers.filter(unionSchema => {\n      if (unionSchema[typebox_1.Kind] !== 'Object') return false;\n      return !Object.entries(unionSchema.properties).find(([property, propertySchema]) => propertySchema.const && propertySchema.const !== currentValue[property]);\n    });\n    if (possibleMatchesByLiterals.length === 1) {\n      Assert(possibleMatchesByLiterals[0], currentValue);\n    } else if (possibleMatchesByLiterals.length > 1) {\n      const errorsOfPossibleMatches = possibleMatchesByLiterals.map(matchSchema => ({\n        schema: matchSchema,\n        errors: [...(0, errors_1.Errors)(matchSchema, currentValue)]\n      }));\n      const sortedErrors = errorsOfPossibleMatches.sort((a, b) => a.errors.length - b.errors.length);\n      const [bestMatch] = sortedErrors;\n      Assert(bestMatch.schema, currentValue);\n    }\n    throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n  }\n}\nfunction Assert(schema, value) {\n  const errors = [...(0, errors_1.Errors)(schema, value)];\n  let [error] = errors;\n  while (error) {\n    if (error.path === '/' && errors.length > 1) {} else if (error.value == null && error.schema[typebox_1.Optional] === 'Optional') {} else if (error.type === errors_1.ValueErrorType.Union) {\n      FindErrorInUnion(error);\n    } else if (error.type === errors_1.ValueErrorType.Number && typeof error.value === 'string') {\n      const currentValue = error.value;\n      const parsedNumber = Number(currentValue);\n      if (!Number.isNaN(parsedNumber) && currentValue === parsedNumber.toString()) {\n        const pathParts = error.path.slice(1).split('/');\n        (0, utils_1.setDeepValue)(value, pathParts, parsedNumber);\n      } else {\n        throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n      }\n    } else {\n      throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n    }\n    errors.shift();\n    [error] = errors;\n  }\n}\nexports.Assert = Assert;\nfunction AssertWeak(schema, value) {\n  try {\n    Assert(schema, value);\n  } catch (e) {\n    if (e instanceof errors_2.InvalidParameter) {\n      if (e.type === errors_1.ValueErrorType.ObjectRequiredProperty) {\n        throw e;\n      }\n      console.warn('Method params validation failed', e);\n    } else {\n      throw e;\n    }\n  }\n}\nexports.AssertWeak = AssertWeak;\nexports.Type = new CustomTypeBuilder();","map":{"version":3,"names":["typebox_1","require","Object","defineProperty","exports","enumerable","get","Optional","TypeClone","errors_1","ts_mixer_1","custom_types_1","errors_2","utils_1","CustomTypeBuilder","Mixin","JavaScriptTypeBuilder","ArrayBufferBuilder","BufferBuilder","KeyofEnumBuilder","UintBuilder","Validate","schema","value","Assert","e","FindErrorInUnion","error","currentValue","unionMembers","anyOf","hasValidMember","find","unionSchema","possibleMatchesByLiterals","filter","Kind","entries","properties","property","propertySchema","const","length","errorsOfPossibleMatches","map","matchSchema","errors","Errors","sortedErrors","sort","a","b","bestMatch","InvalidParameter","message","path","type","ValueErrorType","Union","Number","parsedNumber","isNaN","toString","pathParts","slice","split","setDeepValue","shift","AssertWeak","ObjectRequiredProperty","console","warn","Type"],"sources":["../src/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}