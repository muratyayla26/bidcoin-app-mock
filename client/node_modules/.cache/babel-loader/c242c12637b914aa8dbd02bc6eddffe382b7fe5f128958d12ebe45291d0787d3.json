{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TypeClone = exports.Optional = exports.Type = exports.AssertWeak = exports.Assert = exports.Validate = void 0;\nconst typebox_1 = require(\"@sinclair/typebox\");\nObject.defineProperty(exports, \"Optional\", {\n  enumerable: true,\n  get: function () {\n    return typebox_1.Optional;\n  }\n});\nObject.defineProperty(exports, \"TypeClone\", {\n  enumerable: true,\n  get: function () {\n    return typebox_1.TypeClone;\n  }\n});\nconst errors_1 = require(\"@sinclair/typebox/errors\");\nconst ts_mixer_1 = require(\"ts-mixer\");\nconst custom_types_1 = require(\"./custom-types\");\nconst errors_2 = require(\"./errors\");\nconst utils_1 = require(\"./utils\");\nclass CustomTypeBuilder extends (0, ts_mixer_1.Mixin)(typebox_1.JavaScriptTypeBuilder, custom_types_1.ArrayBufferBuilder, custom_types_1.BufferBuilder, custom_types_1.KeyofEnumBuilder, custom_types_1.UintBuilder) {}\nfunction Validate(schema, value) {\n  try {\n    Assert(schema, value);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nexports.Validate = Validate;\nfunction FindErrorInUnion(error) {\n  const currentValue = error.value;\n  const unionMembers = error.schema.anyOf;\n  const hasValidMember = unionMembers.find(unionSchema => Validate(unionSchema, currentValue));\n  if (!hasValidMember) {\n    const possibleMatchesByLiterals = unionMembers.filter(unionSchema => {\n      if (unionSchema[typebox_1.Kind] !== 'Object') return false;\n      return !Object.entries(unionSchema.properties).find(_ref => {\n        let [property, propertySchema] = _ref;\n        return propertySchema.const && propertySchema.const !== currentValue[property];\n      });\n    });\n    if (possibleMatchesByLiterals.length === 1) {\n      Assert(possibleMatchesByLiterals[0], currentValue);\n    } else if (possibleMatchesByLiterals.length > 1) {\n      const errorsOfPossibleMatches = possibleMatchesByLiterals.map(matchSchema => ({\n        schema: matchSchema,\n        errors: [...(0, errors_1.Errors)(matchSchema, currentValue)]\n      }));\n      const sortedErrors = errorsOfPossibleMatches.sort((a, b) => a.errors.length - b.errors.length);\n      const [bestMatch] = sortedErrors;\n      Assert(bestMatch.schema, currentValue);\n    }\n    throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n  }\n}\nfunction Assert(schema, value) {\n  const errors = [...(0, errors_1.Errors)(schema, value)];\n  let [error] = errors;\n  while (error) {\n    if (error.path === '/' && errors.length > 1) {} else if (error.value == null && error.schema[typebox_1.Optional] === 'Optional') {} else if (error.type === errors_1.ValueErrorType.Union) {\n      FindErrorInUnion(error);\n    } else if (error.type === errors_1.ValueErrorType.Number && typeof error.value === 'string') {\n      const currentValue = error.value;\n      const parsedNumber = Number(currentValue);\n      if (!Number.isNaN(parsedNumber) && currentValue === parsedNumber.toString()) {\n        const pathParts = error.path.slice(1).split('/');\n        (0, utils_1.setDeepValue)(value, pathParts, parsedNumber);\n      } else {\n        throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n      }\n    } else {\n      throw new errors_2.InvalidParameter(error.message, error.path, error.type, error.value);\n    }\n    errors.shift();\n    [error] = errors;\n  }\n}\nexports.Assert = Assert;\nfunction AssertWeak(schema, value) {\n  try {\n    Assert(schema, value);\n  } catch (e) {\n    if (e instanceof errors_2.InvalidParameter) {\n      if (e.type === errors_1.ValueErrorType.ObjectRequiredProperty) {\n        throw e;\n      }\n      console.warn('Method params validation failed', e);\n    } else {\n      throw e;\n    }\n  }\n}\nexports.AssertWeak = AssertWeak;\nexports.Type = new CustomTypeBuilder();","map":{"version":3,"names":["typebox_1","require","Object","defineProperty","exports","enumerable","get","Optional","TypeClone","errors_1","ts_mixer_1","custom_types_1","errors_2","utils_1","CustomTypeBuilder","Mixin","JavaScriptTypeBuilder","ArrayBufferBuilder","BufferBuilder","KeyofEnumBuilder","UintBuilder","Validate","schema","value","Assert","e","FindErrorInUnion","error","currentValue","unionMembers","anyOf","hasValidMember","find","unionSchema","possibleMatchesByLiterals","filter","Kind","entries","properties","_ref","property","propertySchema","const","length","errorsOfPossibleMatches","map","matchSchema","errors","Errors","sortedErrors","sort","a","b","bestMatch","InvalidParameter","message","path","type","ValueErrorType","Union","Number","parsedNumber","isNaN","toString","pathParts","slice","split","setDeepValue","shift","AssertWeak","ObjectRequiredProperty","console","warn","Type"],"sources":["../src/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}